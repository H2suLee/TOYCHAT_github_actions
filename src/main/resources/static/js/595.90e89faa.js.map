{"version":3,"file":"js/595.90e89faa.js","mappings":"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","sources":["webpack://test1/./src/axios.js","webpack://test1/./src/admin/modules/components/chat/ChatService.vue","webpack://test1/./src/admin/modules/components/chat/ChatService.vue?d985"],"sourcesContent":["import axios from \"axios\";\r\n\r\nconst instance = axios.create({\r\n  baseURL: \"http://localhost:9091\", // ë¡œì»¬ í”„ë¡ íŠ¸ì—ì„œ ëŒë¦´ë•Œ\r\n  //baseURL: \"http://localhost:9090\", // ë¡œì»¬ ë°±ì—”ë“œì—ì„œ ëŒë¦´ë•Œ\r\n  //baseURL: \"https://oral-therine-heesu-f4935ad1.koyeb.app\", // ë°±ì—”ë“œ ì„œë²„ ì£¼ì†Œ\r\n});\r\n\r\ninstance.interceptors.request.use(\r\n  (config) => {\r\n    const token = localStorage.getItem(\"jwt\");\r\n    if (token) {\r\n      config.headers.Authorization = `Bearer ${token}`;\r\n    }\r\n    return config;\r\n  },\r\n  (error) => {\r\n    return Promise.reject(error);\r\n  }\r\n);\r\n\r\nexport default instance;\r\n","<template>\r\n  <div class=\"contentW\">\r\n    <ul>\r\n      <li class=\"tit\">ì‹¤ì‹œê°„ ì±„íŒ… ì§€ì›</li>\r\n      <li class=\"navi\">\r\n        <ul>\r\n          <li>í™ˆ</li>\r\n          <li>ì‹¤ì‹œê°„ ì±„íŒ… ì§€ì›</li>\r\n        </ul>\r\n      </li>\r\n    </ul>\r\n    <div v-if=\"chatrooms.length === 0\">ì‹¤ì‹œê°„ ì±„íŒ… ì§€ì›ì´ ì—†ìŠµë‹ˆë‹¤.</div>\r\n    <div v-else>\r\n      <h1 class=\"dpn\">ì‹¤ì‹œê°„ ì±„íŒ… ì§€ì›</h1>\r\n      <table class=\"tbl\">\r\n        <thead>\r\n          <tr>\r\n            <td class=\"wd6\">rId</td>\r\n            <td class=\"wd12\">ìƒì„±ì¼</td>\r\n            <td class=\"wd10\">ë‹µë³€ì</td>\r\n            <td class=\"wd10\">ë¬¸ì˜ì</td>\r\n            <td>ì±„íŒ…</td>\r\n            <td class=\"wd12\">ë§ˆì§€ë§‰ ì±„íŒ…ì¼</td>\r\n            <td class=\"wd10\">ìƒíƒœ(ëŒ€ê¸°/ì§„í–‰ì¤‘/ì™„ë£Œ)</td>\r\n          </tr>\r\n        </thead>\r\n        <tbody>\r\n          <tr\r\n            v-for=\"chat in chatrooms?.slice(\r\n              pageStartIdx,\r\n              pageStartIdx + ITEM_PER_PAGE\r\n            )\"\r\n            :key=\"chat.chatroomId\"\r\n            @click=\"openChatModal(chat.chatroomId)\"\r\n          >\r\n            <td class=\"wd16\">{{ chat.chatroomId }}</td>\r\n            <td class=\"wd12\">{{ chat.credt }}</td>\r\n            <td class=\"wd10\">{{ chat.adm?.nick || \"\" }}</td>\r\n            <td class=\"wd10\">{{ chat.usr?.nick || \"\" }}</td>\r\n            <td>\r\n              {{ chat.lastContent }}\r\n              <p v-if=\"unreadCounts[chat.chatroomId] != null\">\r\n                ( {{ unreadCounts[chat.chatroomId] }} )\r\n              </p>\r\n            </td>\r\n            <td class=\"wd12\">{{ chat.lastCredt }}</td>\r\n            <td class=\"wd10\">{{ chat.status }}</td>\r\n          </tr>\r\n        </tbody>\r\n      </table>\r\n      <Pagination\r\n        v-if=\"chatrooms.length > 0\"\r\n        :list=\"chatrooms\"\r\n        v-bind=\"{ ITEM_PER_PAGE, PAGE_PER_SECTION }\"\r\n        @change-page=\"onChangePage\"\r\n      />\r\n    </div>\r\n    <ChatModal\r\n      v-model:modelValue=\"isModalVisible\"\r\n      :userId=\"userId\"\r\n      :nick=\"nick\"\r\n      :role=\"role\"\r\n      :chatroomId=\"chatroomId\"\r\n    />\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { ref, onMounted, onUnmounted, computed, watch } from \"vue\";\r\nimport axios from \"@/axios.js\";\r\nimport ChatModal from \"../../../../user/modules/components/chat/ChatModal.vue\";\r\nimport Pagination from \"@/common/Pagination.vue\";\r\nimport { useChatStore } from \"@/stores/chatStore\";\r\n\r\nexport default {\r\n  components: { ChatModal, Pagination },\r\n  setup() {\r\n    const userId = ref(localStorage.getItem(\"adminId\"));\r\n    const nick = ref(localStorage.getItem(\"adminNick\"));\r\n    const role = ref(\"ADM\");\r\n    const isModalVisible = ref(false);\r\n    const chatStore = useChatStore();\r\n    const chatrooms = computed(() => chatStore.chatList);\r\n    const unreadCounts = computed(() => chatStore.unreadCounts);\r\n    const chatroomId = ref(\"\");\r\n    let activeAdminChkSocket = null;\r\n\r\n    /* í˜ì´ì§• ê´€ë ¨ */\r\n    const ITEM_PER_PAGE = ref(5);\r\n    const PAGE_PER_SECTION = ref(5);\r\n    let curPage = ref(1);\r\n\r\n    const pageStartIdx = computed(() => {\r\n      return (curPage.value - 1) * ITEM_PER_PAGE.value;\r\n    });\r\n\r\n    const onChangePage = (data) => {\r\n      curPage.value = data;\r\n    };\r\n\r\n    const openChatModal = (id) => {\r\n      chatroomId.value = id;\r\n      isModalVisible.value = true;\r\n      chatStore.markAsRead(id);\r\n    };\r\n\r\n    const getLiveChatWaitingList = async () => {\r\n      try {\r\n        const response = await axios.post(\r\n          \"/api/admin/chat/liveChatWaitingList\",\r\n          {\r\n            //id: userId.value,\r\n          }\r\n        );\r\n\r\n        //chatrooms.value = response.data;\r\n        // pinia\r\n        chatStore.setChatList(response.data);\r\n      } catch (error) {\r\n        console.error(\"Error fetching chat list:\", error);\r\n      }\r\n    };\r\n\r\n    const openActiveAdminChkSocket = () => {\r\n      let url = `ws://localhost:9090/ws/adminOnList?role=adm&nick=${nick.value}`;\r\n      activeAdminChkSocket = new WebSocket(url);\r\n\r\n      activeAdminChkSocket.onopen = () => {\r\n        console.log(\"activeAdminChkSocket connection opened\");\r\n      };\r\n\r\n      activeAdminChkSocket.onmessage = (event) => {\r\n        console.log(\"activeAdminChkSocket got message\");\r\n\r\n        // ì•„ë˜ ë¶€ë¶„ ì™œ ìˆëŠ”ì§€ ëª¨ë¥´ê² ëŠ”ë° ì—†ìœ¼ë©´ í™”ë©´ ë³€í™”ê°€ ì•ˆìƒê¹€\r\n        let jsonArr = JSON.parse(event.data);\r\n        jsonArr.forEach((item) => {\r\n          let jsonObj = {\r\n            chatroomId: item._id,\r\n            id: item.usr.id,\r\n            nick: item.usr.nick,\r\n            credt: item.credt,\r\n            content: item.usr.nick + \"ë‹˜ì´ ì…ì¥í•˜ì˜€ìŠµë‹ˆë‹¤.\",\r\n          };\r\n          // piniaë¡œ ìƒíƒœê´€ë¦¬ {chatroomId, content, credt, id, nick, type}\r\n          chatStore.handleIncomingMessage(jsonObj);\r\n        });\r\n      };\r\n\r\n      activeAdminChkSocket.onclose = () => {\r\n        console.log(\"activeAdminChkSocket connection closed\");\r\n      };\r\n\r\n      activeAdminChkSocket.onerror = (error) => {\r\n        console.error(\"activeAdminChkSocket error:\", error);\r\n      };\r\n    };\r\n\r\n    onMounted(() => {\r\n      // ì›¹ì†Œì¼“ ì—°ê²°\r\n      openActiveAdminChkSocket();\r\n      // ì‹¤ì‹œê°„ ìƒë‹´ ëŒ€ê¸° ë¦¬ìŠ¤íŠ¸\r\n      getLiveChatWaitingList();\r\n    });\r\n\r\n    // ë‹¤ë¥¸ í˜ì´ì§€ë¡œ ì´ë™ì‹œ ì›¹ì†Œì¼“ close\r\n    onUnmounted(() => {\r\n      if (activeAdminChkSocket) {\r\n        activeAdminChkSocket.close();\r\n      }\r\n    });\r\n\r\n    watch(\r\n      () => chatStore.chatList,\r\n      (newVal) => {\r\n        console.log(\"ğŸ‘€ chatStore.chatList ë³€ê²½ë¨ (ì‹¤ì‹œê°„):\", newVal);\r\n      },\r\n      { deep: true }\r\n    );\r\n\r\n    return {\r\n      userId,\r\n      nick,\r\n      role,\r\n      chatrooms,\r\n      unreadCounts,\r\n      chatroomId,\r\n      isModalVisible,\r\n      openChatModal,\r\n      ITEM_PER_PAGE,\r\n      PAGE_PER_SECTION,\r\n      pageStartIdx,\r\n      onChangePage,\r\n      getLiveChatWaitingList,\r\n    };\r\n  },\r\n};\r\n</script>\r\n","import { render } from \"./ChatService.vue?vue&type=template&id=17b76c62\"\nimport script from \"./ChatService.vue?vue&type=script&lang=js\"\nexport * from \"./ChatService.vue?vue&type=script&lang=js\"\n\nimport exportComponent from \"../../../../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__"],"names":["instance","axios","create","baseURL","interceptors","request","use","config","token","localStorage","getItem","headers","Authorization","error","Promise","reject","class","_createElementBlock","_hoisted_1","_createElementVNode","$setup","chatrooms","length","_hoisted_2","_hoisted_3","_hoisted_4","_Fragment","_renderList","slice","pageStartIdx","ITEM_PER_PAGE","chat","key","chatroomId","onClick","$event","openChatModal","_hoisted_6","_toDisplayString","_hoisted_7","credt","_hoisted_8","adm","nick","_hoisted_9","usr","lastContent","unreadCounts","_hoisted_10","_hoisted_11","lastCredt","_hoisted_12","status","_createBlock","_component_Pagination","_mergeProps","list","PAGE_PER_SECTION","onChangePage","_createVNode","_component_ChatModal","modelValue","isModalVisible","userId","role","components","ChatModal","Pagination","setup","ref","chatStore","useChatStore","computed","chatList","activeAdminChkSocket","curPage","value","data","id","markAsRead","getLiveChatWaitingList","async","response","post","setChatList","console","openActiveAdminChkSocket","url","WebSocket","onopen","log","onmessage","event","jsonArr","JSON","parse","forEach","item","jsonObj","_id","content","handleIncomingMessage","onclose","onerror","onMounted","onUnmounted","close","watch","newVal","deep","__exports__","render"],"sourceRoot":""}