"use strict";(self["webpackChunktest1"]=self["webpackChunktest1"]||[]).push([[249],{9249:function(t,a,l){l.r(a),l.d(a,{default:function(){return p}});var o=l(6768),e=l(4232);const s={class:"contentW"},n={class:"tbl"},d=["onClick"],r={class:"wd10"},c={class:"wd10"},i={key:0};function u(t,a,l,u,h,k){const m=(0,o.g2)("Pagination"),E=(0,o.g2)("ChatHistoryModal"),I=(0,o.g2)("ChatModal");return(0,o.uX)(),(0,o.CE)("div",s,[a[4]||(a[4]=(0,o.Lk)("ul",null,[(0,o.Lk)("li",{class:"tit"},"내 채팅"),(0,o.Lk)("li",{class:"navi"},[(0,o.Lk)("ul",null,[(0,o.Lk)("li",null,"홈"),(0,o.Lk)("li",null,"내 채팅")])])],-1)),(0,o.Lk)("div",null,[a[3]||(a[3]=(0,o.Lk)("h1",{class:"dpn"},"내 채팅",-1)),(0,o.Lk)("table",n,[a[2]||(a[2]=(0,o.Lk)("thead",null,[(0,o.Lk)("tr",null,[(0,o.Lk)("td",{class:"wd6"},"rId"),(0,o.Lk)("td",{class:"wd12"},"생성일"),(0,o.Lk)("td",{class:"wd10"},"답변자"),(0,o.Lk)("td",{class:"wd10"},"문의자"),(0,o.Lk)("td",null,"채팅"),(0,o.Lk)("td",{class:"wd12"},"마지막 채팅일"),(0,o.Lk)("td",{class:"wd10"},"상태(대기/진행중/완료)")])],-1)),(0,o.Lk)("tbody",null,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(u.chatrooms?.slice(u.pageStartIdx,u.pageStartIdx+u.ITEM_PER_PAGE),(t=>((0,o.uX)(),(0,o.CE)("tr",{key:t.chatroomId,onClick:a=>"02"===t.status?u.openChatModal(t.chatroomId):u.openChatHistoryModal(t.chatroomId)},[(0,o.Lk)("td",null,(0,e.v_)(t.chatroomId),1),(0,o.Lk)("td",null,(0,e.v_)(t.credt),1),(0,o.Lk)("td",r,(0,e.v_)(Array.isArray(t.adm)?t.adm.map((t=>t.nick)).join(", "):""),1),(0,o.Lk)("td",c,(0,e.v_)(t.usr?.nick||""),1),(0,o.Lk)("td",null,[(0,o.eW)((0,e.v_)(t.lastContent)+" ",1),null!=u.unreadCounts[t.chatroomId]?((0,o.uX)(),(0,o.CE)("p",i," ( "+(0,e.v_)(u.unreadCounts[t.chatroomId])+" ) ",1)):(0,o.Q3)("",!0)]),(0,o.Lk)("td",null,(0,e.v_)(t.lastCredt),1),(0,o.Lk)("td",null,(0,e.v_)(t.status),1)],8,d)))),128))])]),u.chatrooms.length>0?((0,o.uX)(),(0,o.Wv)(m,(0,o.v6)({key:0,list:u.chatrooms},{ITEM_PER_PAGE:u.ITEM_PER_PAGE,PAGE_PER_SECTION:u.PAGE_PER_SECTION},{onChangePage:u.onChangePage}),null,16,["list","onChangePage"])):(0,o.Q3)("",!0)]),(0,o.bF)(E,{modalValue:u.isChatHistoryModalVisible,"onUpdate:modalValue":a[0]||(a[0]=t=>u.isChatHistoryModalVisible=t),chatroomId:u.chatroomId},null,8,["modalValue","chatroomId"]),(0,o.bF)(I,{modelValue:u.isModalVisible,"onUpdate:modelValue":a[1]||(a[1]=t=>u.isModalVisible=t),userId:u.userId,nick:u.nick,role:u.role,chatroomId:u.chatroomId},null,8,["modelValue","userId","nick","role","chatroomId"])])}var h=l(144),k=l(3173),m=l(6076),E=l(6598),I=l(9383),C=l(1102),L=l(5897),v=l(7203),P={components:{ChatHistoryModal:m.A,ChatModal:E.A,Pagination:I.A},setup(){const t=(0,h.KR)(localStorage.getItem("adminId")),a=(0,h.KR)(localStorage.getItem("adminNick")),l=(0,h.KR)("ADM"),e=(0,L.L)(),s=(0,o.EW)((()=>e.chatList)),n=(0,o.EW)((()=>e.unreadCounts)),d=(0,h.KR)(""),r=(0,h.KR)(!1),c=(0,h.KR)(!1),i=(0,h.KR)(C.y.ITEM_PER_PAGE),u=(0,h.KR)(C.y.PAGE_PER_SECTION);let m=(0,h.KR)(1);const E=(0,o.EW)((()=>(m.value-1)*i.value)),I=t=>{m.value=t},P=async()=>{try{const a=await k.A.post("/api/admin/chat/mylist",{id:t.value});e.setChatList(a.data)}catch(a){console.error("Error fetching mylist:",a),console.log(a)}},_=t=>{d.value=t,r.value=!0},g=t=>{d.value=t,c.value=!0,e.markAsRead(t)},p=()=>{d.value=""};function y(t){return new Promise((a=>{t.readyState===WebSocket.OPEN?a():t.addEventListener("open",a,{once:!0})}))}return(0,o.sV)((async()=>{await P();const t=(0,v.mn)();await y(t);const a=e.chatList.filter((t=>"02"===t.status)).map((t=>t.chatroomId));a.forEach((t=>{const a={chatroomId:t,type:"REJOIN"};(0,v.wI)(a)}))})),{userId:t,nick:a,role:l,chatrooms:s,unreadCounts:n,chatroomId:d,isChatHistoryModalVisible:r,isModalVisible:c,openChatHistoryModal:_,openChatModal:g,resetChatroomId:p,ITEM_PER_PAGE:i,PAGE_PER_SECTION:u,pageStartIdx:E,onChangePage:I}}},_=l(1241);const g=(0,_.A)(P,[["render",u]]);var p=g}}]);
//# sourceMappingURL=249.0cd51217.js.map