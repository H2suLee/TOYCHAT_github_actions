"use strict";(self["webpackChunktest1"]=self["webpackChunktest1"]||[]).push([[961],{6961:function(t,a,e){e.r(a),e.d(a,{default:function(){return y}});var o=e(6768),n=e(4232);const l={class:"contentW"},s={key:0},c={key:1},d={class:"tbl"},r=["onClick"],i={class:"wd16"},u={class:"wd12"},k={class:"wd10"},h={class:"wd10"},m={key:0},E={class:"wd12"},I={class:"wd10"};function C(t,a,e,C,L,g){const v=(0,o.g2)("Pagination"),_=(0,o.g2)("ChatModal");return(0,o.uX)(),(0,o.CE)("div",l,[a[3]||(a[3]=(0,o.Lk)("ul",null,[(0,o.Lk)("li",{class:"tit"},"실시간 채팅 지원"),(0,o.Lk)("li",{class:"navi"},[(0,o.Lk)("ul",null,[(0,o.Lk)("li",null,"홈"),(0,o.Lk)("li",null,"실시간 채팅 지원")])])],-1)),0===C.chatrooms.length?((0,o.uX)(),(0,o.CE)("div",s,"실시간 채팅 지원이 없습니다.")):((0,o.uX)(),(0,o.CE)("div",c,[a[2]||(a[2]=(0,o.Lk)("h1",{class:"dpn"},"실시간 채팅 지원",-1)),(0,o.Lk)("table",d,[a[1]||(a[1]=(0,o.Lk)("thead",null,[(0,o.Lk)("tr",null,[(0,o.Lk)("td",{class:"wd6"},"rId"),(0,o.Lk)("td",{class:"wd12"},"생성일"),(0,o.Lk)("td",{class:"wd10"},"답변자"),(0,o.Lk)("td",{class:"wd10"},"문의자"),(0,o.Lk)("td",null,"채팅"),(0,o.Lk)("td",{class:"wd12"},"마지막 채팅일"),(0,o.Lk)("td",{class:"wd10"},"상태(대기/진행중/완료)")])],-1)),(0,o.Lk)("tbody",null,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(C.chatrooms?.slice(C.pageStartIdx,C.pageStartIdx+C.ITEM_PER_PAGE),(t=>((0,o.uX)(),(0,o.CE)("tr",{key:t.chatroomId,onClick:a=>C.openChatModal(t.chatroomId)},[(0,o.Lk)("td",i,(0,n.v_)(t.chatroomId),1),(0,o.Lk)("td",u,(0,n.v_)(t.credt),1),(0,o.Lk)("td",k,(0,n.v_)(Array.isArray(t.adm)?t.adm.map((t=>t.nick)).join(", "):""),1),(0,o.Lk)("td",h,(0,n.v_)(t.usr?.nick||""),1),(0,o.Lk)("td",null,[(0,o.eW)((0,n.v_)(t.lastContent)+" ",1),null!=C.unreadCounts[t.chatroomId]?((0,o.uX)(),(0,o.CE)("p",m," ( "+(0,n.v_)(C.unreadCounts[t.chatroomId])+" ) ",1)):(0,o.Q3)("",!0)]),(0,o.Lk)("td",E,(0,n.v_)(t.lastCredt),1),(0,o.Lk)("td",I,(0,n.v_)(t.status),1)],8,r)))),128))])]),C.chatrooms.length>0?((0,o.uX)(),(0,o.Wv)(v,(0,o.v6)({key:0,list:C.chatrooms},{ITEM_PER_PAGE:C.ITEM_PER_PAGE,PAGE_PER_SECTION:C.PAGE_PER_SECTION},{onChangePage:C.onChangePage}),null,16,["list","onChangePage"])):(0,o.Q3)("",!0)])),(0,o.bF)(_,{modelValue:C.isModalVisible,"onUpdate:modelValue":a[0]||(a[0]=t=>C.isModalVisible=t),userId:C.userId,nick:C.nick,role:C.role,chatroomId:C.chatroomId},null,8,["modelValue","userId","nick","role","chatroomId"])])}var L=e(144),g=e(3173),v=e(6598),_=e(9383),P=e(1102),p=e(5897),w=e(7203),A={components:{ChatModal:v.A,Pagination:_.A},setup(){const t=(0,L.KR)(localStorage.getItem("adminId")),a=(0,L.KR)(localStorage.getItem("adminNick")),e=(0,L.KR)("ADM"),n=(0,L.KR)(!1),l=(0,p.L)(),s=(0,o.EW)((()=>l.chatList)),c=(0,o.EW)((()=>l.unreadCounts)),d=(0,L.KR)("");let r=null;const i=(0,L.KR)(P.y.ITEM_PER_PAGE),u=(0,L.KR)(P.y.PAGE_PER_SECTION);let k=(0,L.KR)(1);const h=(0,o.EW)((()=>(k.value-1)*i.value)),m=t=>{k.value=t},E=t=>{d.value=t,n.value=!0,l.markAsRead(t)},I=async()=>{try{const t=await g.A.post("/api/admin/chat/liveChatWaitingList",{});l.setChatList(t.data)}catch(t){console.error("Error fetching livelist:",t)}},C=()=>{let t=`ws://localhost:9090/ws/adminOnList?role=adm&nick=${a.value}`;r=new WebSocket(t),r.onopen=()=>{console.log("activeAdminChkSocket connection opened")},r.onmessage=t=>{console.log("activeAdminChkSocket got message");let a=JSON.parse(t.data);a.forEach((t=>{let a={chatroomId:t._id,id:t.usr.id,nick:t.usr.nick,credt:t.credt,content:t.usr.nick+"님이 입장하였습니다."};l.handleIncomingMessage(a)}))},r.onclose=()=>{console.log("activeAdminChkSocket connection closed")},r.onerror=t=>{console.error("activeAdminChkSocket error:",t)}};function v(t){return new Promise((a=>{t.readyState===WebSocket.OPEN?a():t.addEventListener("open",a,{once:!0})}))}return(0,o.sV)((async()=>{C(),await I();const t=(0,w.mn)();await v(t);const a=l.chatList.map((t=>t.chatroomId));a.forEach((t=>{const a={chatroomId:t,type:"REJOIN"};(0,w.wI)(a)}))})),(0,o.hi)((()=>{r&&r.close()})),{userId:t,nick:a,role:e,chatrooms:s,unreadCounts:c,chatroomId:d,isModalVisible:n,openChatModal:E,ITEM_PER_PAGE:i,PAGE_PER_SECTION:u,pageStartIdx:h,onChangePage:m}}},R=e(1241);const S=(0,R.A)(A,[["render",C]]);var y=S}}]);
//# sourceMappingURL=961.079314ac.js.map